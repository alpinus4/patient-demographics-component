<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="patient-demographics.html">
<link rel="import" href="https://polygit.org/polymer+v2.0.0/shadycss+webcomponents+1.0.0/components/iron-ajax/iron-ajax.html">


<dom-module id="get-patient">
  <template>


    <patient-demographics first-name="{{patient.0.person.preferredName.givenName}}"
                          middle-name="{{patient.0.person.preferredName.middleName}}"
                          last-name="{{patient.0.person.preferredName.familyName}}"
                          age="{{patient.0.person.age}}"
                          date-of-birth="{{patient.0.person.birthdate}}"
                          gender="{{patient.0.person.gender}}"></patient-demographics>

    <iron-ajax
    auto
    url="http://localhost:8080/lh-toolkit/ws/rest/v1/patient"
    params='{"q":"James", "v":"full"}'
    content-type="application/json"
    handle-as="json"
    with-credentials="true"
    on-response="handleResponse"
    method="GET"
    on-error="_error"></iron-ajax>

  </template>

  <script>
    class GetPatient extends Polymer.Element {
      static get is() {
        return 'get-patient';
      }
      static get properties() {
        return {
          patient: {
            type: Array
          }
        }
      }
      constructor() {
        super();
      }
      handleResponse(data){
        this.patient = data.detail.response.results;
      }

      _error(event){
        console.log(event);
        console.log(event.detail);
        console.log(event.detail.error);
        console.log(event.detail.error.message);
        console.log(event.detail.request);
        console.log(event.detail.response);
        console.log(event.detail.request.response);
      }

      getCorrectGender(data){

      }

      getCorrectBirthDate(data){
        return data.substring(0,10);
      }
    }
    customElements.define(GetPatient.is, GetPatient);
  </script>
</dom-module>
