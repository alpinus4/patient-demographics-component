<link rel="import" href="bower_components/polymer/polymer-element.html">
<link rel="import" href="patient-demographics.html">
<link rel="import" href="https://polygit.org/polymer+v2.0.0/shadycss+webcomponents+1.0.0/components/iron-ajax/iron-ajax.html">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>



<dom-module id="get-patient">
  <template>

    <patient-demographics first-name="{{patient.person.preferredName.givenName}}"
                          middle-name="{{patient.person.preferredName.middleName}}"
                          last-name="{{patient.person.preferredName.familyName}}"
                          age="{{patient.person.age}}"
                          date-of-birth="{{patient.person.birthdate}}"
                          gender="{{patient.person.gender}}"
                          patientid="{{patient.identifiers.0.identifier}}"
                          address="{{patient.person.preferredAddress.address1}}"
                          city-village="{{patient.person.preferredAddress.cityVillage}}"
                          state-province="{{patient.person.preferredAddress.stateProvince}}"
                          country="{{patient.person.preferredAddress.country}}"
                          telephone-number="500-500-5643"
                          dead="{{patient.person.dead}}"></patient-demographics>

    <iron-ajax
    url="{{url}}"
    params='{"v":"full"}'
    content-type="application/json"
    handle-as="json"
    with-credentials="true"
    on-response="handleResponse"
    method="GET"
    on-error="_error"
    id="iron_ajax"></iron-ajax>

  </template>

  <script>
    class GetPatient extends Polymer.Element {
      static get is() {
        return 'get-patient';
      }
      static get properties() {
        return {
          patient: {
            type: Object
          },
          uuid: {
            type: String,
            observer: "_changedUUID"
          },
          url: {
            type: String
          }
        }
      }
      constructor() {
        super();
      }
      handleResponse(data){
        this.patient = data.detail.response;
        console.log(data.detail.response);
      }


      _error(event){
        console.log(event);
        console.log(event.detail);
        console.log(event.detail.error);
        console.log(event.detail.error.message);
        console.log(event.detail.request);
        console.log(event.detail.response);
        console.log(event.detail.request.response);
      }

      _changedUUID(){
        this.url = "http://localhost:8080/lh-toolkit/ws/rest/v1/patient/" + this.uuid;
        this.$.iron_ajax.generateRequest();
      }

    }
    customElements.define(GetPatient.is, GetPatient);
  </script>
</dom-module>
